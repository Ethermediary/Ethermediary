'use strict';

var path = require('path');
var duster = require('..');
var dust = duster.dust;
var expected = 'foo bar';

module.exports = function(gulp) {
  gulp.task('test', function(cb) {
    duster.prime(path.join(process.cwd(), 'test', 'src'), function(err) {
      if (err) {
        console.log(err);
        gulp.fail = true;
      }
      dust.render('foo', {}, function(err, out) {
        console.log('expected:', expected);
        console.log('  actual:', out);
        if (err || out !== expected) {
          gulp.fail = true;
        }
        cb();
      });
    });
  });
};
